#include "include/spectrum-to-xyz.h"
#include "spectrum.h"
namespace {

/* Absolutes spectral sensitivity of panchromatic emulsion. log.  */
const static spectra_entry absolute_panchromatic[] = {
  {337.07194243011116, 0.047135149544788035},
  {338.2769364579749, 0.1294267981014965},
  {339.14068001310187, 0.21079121681531277},
  {340.58215190049447, 0.2758827517863658},
  {341.82141420119524, 0.35933343764669035},
  {343.2638014867538, 0.4312401119630027},
  {345.66109050572857, 0.5012790804529179},
  {347.1727197895808, 0.5807559241294173},
  {349.26050014530193, 0.6322171804099508},
  {351.5553473024728, 0.7014812496740204},
  {354.2263483794551, 0.7775604582833493},
  {357.30486977462795, 0.8400093882021586},
  {360.72449841697414, 0.9023192336445338},
  {364.82685930073484, 0.9682055370523521},
  {369.6110023333529, 1.0305948593384047},
  {374.7361245107772, 1.0918913750239043},
  {380.5437861829985, 1.1553293501084663},
  {387.37496245118774, 1.2197858731265079},
  {394.88764708716496, 1.2787071149612221},
  {402.3984975301567, 1.3239727900187916},
  {409.90693634903784, 1.3512839235730798},
  {417.4137787406909, 1.3667096564139274},
  {424.91973800238793, 1.375560486732447},
  {432.4253236321805, 1.3816296275222886},
  {439.92972043318616, 1.3788479379936112},
  {447.4330303050152, 1.3679740607451443},
  {454.93647604299133, 1.3581117069616515},
  {462.43975194828363, 1.3469849488469419},
  {469.94309578664945, 1.336363952464719},
  {477.4466094576992, 1.3270073604137123},
  {484.9499872626018, 1.3166392448977327},
  {492.4538745655559, 1.3100643423754046},
  {499.95830533309834, 1.30753553371297},
  {507.4640607955747, 1.3148690788340294},
  {514.9716164844999, 1.3356053098659881},
  {522.4805308348958, 1.3664567755476842},
  {529.9905321144684, 1.4054004289491688},
  {536.4796011983823, 1.462551504720179},
  {541.9459293685547, 1.5244440967332529},
  {548.4350409106396, 1.581911273587067},
  {555.945789454021, 1.6264183060459065},
  {563.4550095032479, 1.6595456995237932},
  {570.9640936863276, 1.691661569536706},
  {578.4719211075469, 1.7144208474986122},
  {585.978016235391, 1.7242832012821054},
  {593.4808166091685, 1.709616111039988},
  {600.9833792171887, 1.6931788547341662},
  {608.4876061855106, 1.6891327608742719},
  {615.992036953053, 1.6866039522118377},
  {623.4934107322862, 1.6613158655874973},
  {630.9939013815635, 1.6294528764408276},
  {638.4956487927012, 1.6069464793451642},
  {645.9985170995523, 1.592785150835534},
  {653.5023364694329, 1.5857044865807182},
  {661.008567463424, 1.5965783638291846},
  {668.517923378798, 1.630717280772045},
  {676.0275170599293, 1.6666263637786085},
  {683.53028346717, 1.6517063926702473},
  {691.034340602808, 1.6463958944791361},
  {698.5386694707402, 1.6431084432179714},
  {706.0464629254226, 1.6656148403136348},
  {713.5581285652969, 1.7169496561610469},
  {721.0694205732665, 1.7655027824797807},
  {728.5792180536184, 1.8029291506838052},
  {736.0819165277858, 1.7875034178429572},
  {741.5314805137359, 1.7245866583215976},
  {744.080135823604, 1.6517063926702473},
  {745.2661368963245, 1.5925954901858512},
  {746.6224207095011, 1.5313983205549464},
  {748.319674771486, 1.469042113620426},
  {749.6752113208537, 1.4022815649321667},
  {750.7569753194292, 1.3290304073436596},
  {752.6561462897808, 1.246136059389071},
  {753.7390810016572, 1.1816008623237533},
  {755.3665468510881, 1.1076079208609326},
  {757.3543433091768, 1.007281651859964},
  {758.7543005405186, 0.932608741845689},
  {760.1755210597564, 0.8469288409047437},
  {761.5306139212374, 0.7768650359011797},
  {762.5459586215976, 0.717058711034614},
  {763.9016819869174, 0.6516890071106931},
  {765.5288115676344, 0.5751925450720625},
  {766.9506117352574, 0.49382812635824624},
  {768.3058680606966, 0.42498131052347876},
  {769.3207768571682, 0.3619296812067887},
  {770.9478939834883, 0.2853404961838688},
  {772.3703293253488, 0.20870494966880404},
  {773.3838992741628, 0.13568559954102088},
  {773.709893110801, 0.02302717362958262},
};

/* Panchromatic emulsion wedge sensitivity to thungsten light.  */
const static spectra_entry wedge_thungsten_panchromatic[] = {
  {355.14229725410485, 0.033397353819889286},
  {358.33024315663425, 0.08409932860875857},
  {361.4818246572336, 0.13541217056375832},
  {364.560677353973, 0.18788566013440677},
  {367.5607405131974, 0.23736590059101426},
  {370.4517104666318, 0.28645344072653733},
  {373.50632022875124, 0.33357747925663883},
  {376.5609299908706, 0.3807015177867408},
  {379.61553975299, 0.4281397165737104},
  {382.88833592668936, 0.47707017658079964},
  {386.3793185119687, 0.5265504170374067},
  {389.870301097248, 0.5741064259207014},
  {393.7976565056872, 0.6214425226241889},
  {398.37957114886626, 0.6644453497846585},
  {403.17967220362533, 0.6966324961018857},
  {407.9797732583844, 0.7214225963710543},
  {412.7798743131434, 0.740814852226775},
  {417.5799753679025, 0.7576081459575026},
  {422.38007642266155, 0.7706029565824699},
  {427.18017747742056, 0.7821983260632102},
  {431.9802785321796, 0.7935937753804894},
  {436.7803795869387, 0.8029900230631584},
  {441.5804806416977, 0.8109868296015998},
  {446.3805816964568, 0.8157849135246646},
  {451.18068275121584, 0.8205829974477299},
  {455.98078380597485, 0.8229820394092622},
  {460.7808848607339, 0.8239816402265674},
  {465.580985915493, 0.8239816402265674},
  {470.381086970252, 0.8213826781015741},
  {475.18118802501107, 0.817384274832353},
  {479.98128907977014, 0.8139856320535155},
  {484.78139013452915, 0.806988426332379},
  {489.5814911892882, 0.7975921786497102},
  {494.3815922440473, 0.7867964898228141},
  {499.1816932988063, 0.7797992841016776},
  {503.98179435356536, 0.7789996034478335},
  {508.78189540832443, 0.7855969688420479},
  {513.5819964630834, 0.7977920988131713},
  {518.3820975178426, 0.8137857118900544},
  {523.1821985726016, 0.831578606438087},
  {527.9822996273606, 0.8499712614765025},
  {532.7824006821196, 0.86876375684184},
  {537.5825017368787, 0.8871564118802557},
  {542.3826027916377, 0.9051492265917491},
  {547.1827038463967, 0.9231420413032427},
  {551.9828049011559, 0.940735015687814},
  {556.7829059559149, 0.9571284690916191},
  {561.5830070106739, 0.9681240780819762},
  {566.383108065433, 0.9741216829858075},
  {571.183209120192, 0.9795195273992556},
  {575.9833101749512, 0.9797194475627167},
  {580.78341122971, 0.9727222418415802},
  {585.5835122844692, 0.9617266328512231},
  {590.3836133392283, 0.940335175360892},
  {595.1837143939872, 0.9215426799955544},
  {599.9838154487463, 0.9115466718225025},
  {604.7839165035055, 0.9073483483898206},
  {609.5840175582643, 0.9069485080628985},
  {614.3841186130235, 0.9129461129667298},
  {619.1842196677825, 0.9247414026109311},
  {623.9843207225415, 0.9309389276782232},
  {628.7844217773006, 0.9183439573801777},
  {632.3844975683699, 0.8734618806831744},
  {634.0208956552196, 0.8195833966304245},
  {634.8390946986444, 0.7648802419033978},
  {636.1482131681241, 0.7101770871763711},
  {637.4246036758668, 0.654209437415453},
  {638.7664501070836, 0.5966474243509334},
  {640.0428406148263, 0.5416144013541961},
  {641.5846912566581, 0.48287341465904365},
  {642.6938055155229, 0.43198817972033554},
  {644.4938434110575, 0.36832360366616745},
  {646.4575211152771, 0.3036144447579159},
  {648.2030124079167, 0.24203903441191565},
  {650.1182042428964, 0.17670679099421083},
  {651.912181404776, 0.11586442124756768},
  {653.8516161743756, 0.06259680436094861},
  {655.6213504016353, 0.02212685460477326},
};

/* Panchromatic emulsion wedge sensitivity to thungsten light.  */
const static spectra_entry wedge_Neopan_100_acros_daylight_5400k [] = {
  {380.1729818452725, 1.5732847620784898},
  {385.81266010382103, 1.5310698897253516},
  {391.61046018270264, 1.543692036238022},
  {397.62787390093587, 1.5757761441660834},
  {403.2060603404659, 1.5699302283904912},
  {409.0038604193476, 1.5370814898371168},
  {414.8016604982292, 1.534298199879324},
  {420.5994605771108, 1.5392176281567633},
  {426.39726065599245, 1.5426462077435126},
  {432.1950607348741, 1.543590039512445},
  {437.9928608137557, 1.5415521738999973},
  {443.79066089263733, 1.5340478630883534},
  {449.588460971519, 1.5185923592596957},
  {455.3862610504006, 1.4909615911237357},
  {461.1840611292822, 1.4526464073711645},
  {466.9818612081639, 1.4098586775465227},
  {472.77966128704554, 1.364834674685846},
  {478.57746136592715, 1.3205560961705145},
  {484.37526144480876, 1.2802531141636897},
  {490.1730615236904, 1.2479013251738782},
  {495.9708616025721, 1.2344336195994736},
  {501.5659413989753, 1.2578948398937064},
  {507.5664617603353, 1.292476583819997},
  {513.364261839217, 1.3359096032735946},
  {519.1620619180986, 1.3813304209814463},
  {524.9598619969802, 1.42699971347108},
  {530.7576620758618, 1.470184258142897},
  {536.5554621547435, 1.5101386306515514},
  {542.3532622336252, 1.5433841840521012},
  {548.1510623125067, 1.5587395531643709},
  {553.9488623913884, 1.5688769518592252},
  {559.7466624702699, 1.5879594426982198},
  {565.5444625491516, 1.6174778743720448},
  {571.3422626280333, 1.6452569825733976},
  {577.1400627069149, 1.6640909986306105},
  {582.9378627857966, 1.6610592338910364},
  {588.7356628646781, 1.62647117186519},
  {594.5334629435598, 1.5886529376761818},
  {600.2907189659458, 1.5551738055673625},
  {606.4218812871252, 1.5171827953158257},
  {611.9268631802047, 1.497064015905944},
  {617.7246632590864, 1.5191282041263188},
  {623.522463337968, 1.5660398705248606},
  {629.3202634168497, 1.582140663982475},
  {633.4489998366593, 1.5295525936078467},
  {634.8545271285093, 1.4730538556747668},
  {636.1722089646188, 1.4133671166384905},
  {637.602834958109, 1.3411195936516283},
  {638.5440362696158, 1.2762299674575592},
  {639.3346453712816, 1.2187343580789802},
  {640.4766362959097, 1.1586847065554307},
  {641.5307817647972, 1.0912561126093014},
  {643.6566417937206, 0.9619563256169599},
  {644.5300766107989, 0.8838306780362957},
  {645.6595181846069, 0.7975291825817941},
  {646.7136636534945, 0.7228640564195863},
  {647.9654613977984, 0.6462546830680491},
};
/* Response to mean moon sunlight (probably between 5000-5500k).  */
const static spectra_entry ilford_manual_of_photography_panchromatic_emulsion_fig54 [] = {
  {359.879849627755, 0.31079387699942806},
  {363.25987243167424, 0.3300672108428788},
  {367.36514775946716, 0.38326545697272607},
  {371.5592925471522, 0.46359357433074244},
  {376.206424720676, 0.5845300976672299},
  {383.767734599828, 0.799717620411494},
  {389.9581507736075, 1.0243269516350573},
  {399.2441864669615, 1.3567151889388605},
  {411.7937062152416, 1.9597603035362443},
  {419.07853333028487, 2.202176441353002},
  {427.4577713865918, 2.462399385762952},
  {434.5558080627878, 2.7501224908172883},
  {443.4723772052941, 3.1278670672808335},
  {450.94111473039175, 3.3566565545808036},
  {457.5034660511271, 3.508754989455376},
  {466.6405631126249, 3.470080317094931},
  {472.59481692539487, 3.2783938292999064},
  {478.37256611643477, 3.0188703204539227},
  {484.0655601744294, 2.686959345064354},
  {488.7501327222596, 2.3960517510305515},
  {494.34808583009186, 2.1048972973859374},
  {500.2151159137085, 1.8679779002365802},
  {508.2639735242129, 1.7436100283098153},
  {516.6707775703937, 1.7006070841064744},
  {524.8932597738354, 1.6757565499514655},
  {532.74545256106, 1.7053138740192786},
  {540.9638204376549, 1.7257209351796838},
  {549.362395830142, 1.7732331816071785},
  {559.0380582758933, 1.8385028627057025},
  {569.2588690288529, 1.9353047447585308},
  {577.6664959404031, 1.8832502814921082},
  {586.079882909539, 1.7678351847841043},
  {594.4920355806207, 1.6659973666707213},
  {604.1796295742279, 1.6000200213545384},
  {612.9505515463555, 1.5704956119015012},
  {621.5346830796358, 1.5862781696860395},
  {629.7575767157622, 1.556901875999488},
  {638.1701408195288, 1.4505382983545658},
  {645.8569376675097, 1.2900630940197928},
  {652.6324111189122, 1.1072059516381216},
  {659.9579700697393, 0.9015718958322623},
  {666.5573503320963, 0.6463519728680875},
  {672.0561481629194, 0.4412116362838461},
  {678.2848275763747, 0.2449253310740378},
  {685.7004902851478, 0.0528438679017178},
  {693.4699851027507, 0},
  {699.6817957761339, 0},
};

/* Ilford fp4 equal energy spectral sensitivity. (relative log sensitivity)  */
const static spectra_entry ilford_fp4_absolute[] = {
  {351.6820562682886, 1.3045820482561394},
  {353.9149734707438, 1.3033155303535586},
  {356.83309935292294, 1.301914153848439},
  {359.3599128953425, 1.3019737953690154},
  {361.9904098929244, 1.2985745648941263},
  {364.6206715519246, 1.29582957567652},
  {367.25081554163387, 1.2934117070875548},
  {369.8815871008945, 1.2892491951458358},
  {372.5116134213129, 1.2871584471855122},
  {375.1420711957979, 1.28386825692017},
  {377.7725681933798, 1.2804690264452812},
  {380.40306519096174, 1.2770697959703918},
  {383.0889331328051, 1.2730830276403413},
  {385.74363958126474, 1.2705342735882637},
  {388.2939678372531, 1.2685077076889315},
  {390.92462172722287, 1.2646723163758538},
  {393.4068480639676, 1.2581597035509413},
  {396.29511484216823, 1.252486492457128},
  {399.0033136664511, 1.2508810135240103},
  {401.4842991914188, 1.245972053797052},
  {404.09118780694087, 1.241755194332186},
  {406.71023166021064, 1.2369712394868617},
  {409.3406109885017, 1.233899129640614},
  {411.9005064115567, 1.2313342436552812},
  {414.60227177631384, 1.2252469851285348},
  {417.23308255867147, 1.2209754329772684},
  {419.83169640817164, 1.2176127793477307},
  {422.34089355031017, 1.2128540217934463},
  {425.1255541288412, 1.2080517363139232},
  {427.7576200503015, 1.2002908974571491},
  {430.3898820872466, 1.1919848575526395},
  {433.15776288481595, 1.1804339006424533},
  {435.59179302402396, 1.1722401492736372},
  {438.20433199584113, 1.1614357408341238},
  {441.01333419508563, 1.1518905009576452},
  {443.52514568414745, 1.13980300828699},
  {446.2133148526324, 1.1255852377137474},
  {448.9719566497129, 1.1148003529937396},
  {451.27588797878127, 1.0976702910985079},
  {453.70163844416516, 1.0855772196984912},
  {455.92128795171203, 1.070220997394159},
  {458.17888980529085, 1.0608340783492451},
  {459.8281229746911, 1.0443298816684128},
  {462.02544398292264, 1.0358870742856672},
  {463.88795504928055, 1.017670372965557},
  {466.0855013019145, 1.0086013861441623},
  {467.73546255005203, 0.9900731305736113},
  {469.920493356551, 0.98192115834024},
  {471.3301400827942, 0.9614405515458319},
  {473.53504499905165, 0.9514350166880415},
  {474.6691836492824, 0.931122035962119},
  {476.89218909090334, 0.9214247976348562},
  {477.9502827765907, 0.9007564884082326},
  {480.2192084434653, 0.8802343093550733},
  {482.5679365182652, 0.8557708864896065},
  {484.736779971876, 0.8294195528702413},
  {486.7427875848394, 0.8031585173774989},
  {488.8620472757911, 0.7747575573898094},
  {491.840351817069, 0.7458132129221298},
  {494.3666951492667, 0.7550906258972044},
  {496.9878766613208, 0.777588445189757},
  {499.6090581733748, 0.8000862644823091},
  {502.2318674439527, 0.8180589150786559},
  {504.8557357381485, 0.8330874800172304},
  {507.48087878299543, 0.8445722381455235},
  {510.1065317281029, 0.854639473549704},
  {512.733439812313, 0.8612174222483763},
  {515.3611323584623, 0.8656145667561066},
  {517.9893936395175, 0.8684306282254034},
  {520.6179883168969, 0.8703198479135498},
  {523.247387067764, 0.86997374330598},
  {525.8779625115399, 0.8663564324119967},
  {528.5081653358945, 0.8637750035087111},
  {531.134269346617, 0.8725882765030993},
  {533.7585690948794, 0.8864173991366557},
  {536.3817902079753, 0.9032451275327574},
  {539.0060115100437, 0.9172923305854078},
  {541.6320174630238, 0.9263782041036642},
  {544.2570624501284, 0.938135562755825},
  {546.8807542403878, 0.9536548086373616},
  {549.5036223456111, 0.9714638989193878},
  {552.1287850020066, 0.9828941369429073},
  {554.754477170211, 0.9928523321375405},
  {557.3807576848698, 1.0011749241889671},
  {560.0074892651435, 1.0082435538306016},
  {562.6350053073566, 1.013131379281294},
  {565.2064500646995, 1.0156856359172193},
  {568.0779857561682, 1.0172355969846874},
  {570.5223386518246, 1.0144919500686214},
  {573.1536397228942, 1.0088573952980162},
  {575.7850388517062, 1.0029502400035433},
  {578.3603751005976, 0.994686150135115},
  {580.8691572250149, 0.9815884374004593},
  {583.2946124849848, 0.9703160370512446},
  {585.5137169979213, 0.9564748997637775},
  {587.7901838156084, 0.948039843002038},
  {588.9240451025106, 0.9284979323293414},
  {591.1408651606229, 0.9192442287824953},
  {593.0044929316238, 0.8979230885552788},
  {595.2217027486615, 0.887585855195076},
  {596.3571049429444, 0.8637602220044567},
  {598.448948348333, 0.8579706754852267},
  {599.03115638805, 0.8342066718658699},
  {600.2176655305643, 0.8138585240847668},
  {602.4622842922511, 0.8029797040704231},
  {603.2800556922414, 0.7786159575749954},
  {605.7452092331716, 0.7748404750167814},
  {605.7531322987575, 0.7528143526882628},
  {608.3809817372946, 0.7567753363578046},
  {611.0057717742689, 0.7692414563720216},
  {613.6284829871045, 0.7874867074922363},
  {616.2508608036158, 0.8066588003936013},
  {618.8736504626452, 0.8246859710947217},
  {621.4959106098655, 0.8441851846247281},
  {624.1192493922524, 0.8606857923921889},
  {626.7448238911659, 0.8709711082154635},
  {629.1872940781682, 0.8734613913576594},
  {631.1853746391461, 0.852516750920739},
  {632.4134439214802, 0.7830803455567206},
  {632.5125824781061, 0.7474296316128015},
  {632.9127561248343, 0.7055130061390095},
  {633.1294419449257, 0.675325555343152},
  {633.2884161740633, 0.6209959631858454},
  {633.3851282625201, 0.5565946068652401},
  {633.5634847358783, 0.5207946725042005},
  {634.6185929658091, 0.48007667718659586},
  {634.7873041956569, 0.44102313013914984},
  {635.121896824269, 0.37980318335021157},
  {635.84362702317, 0.35225700321236597},
  {636.09362383659, 0.32175517306849066},
  {636.482616659365, 0.2798062625032611},
  {637.1371324783265, 0.24329860408022186},
  {637.5783805521908, 0.17579364599053626},
  {637.7319638180815, 0.1401425389440234},
  {637.9127697810286, 0.1058087145808202},
  {638.3041910738355, 0.06660136177254294},
  {638.5901465018878, 0.035807979625009034},
  {638.8501222315044, 0.015535580235860325}
};
/* Ilford SFX200 wedge spectrogramto tungsten light. (Sensitivity)  */
const static spectra_entry ilford_sfx200_wedge_tungsten[] = {
  {354.0041067761807, -0.06451612903225734},
  {358.93223819301846, 0.020737327188940613},
  {365.2292950034223, 0.13594470046082985},
  {371.80013689253934, 0.2419354838709682},
  {381.3826146475017, 0.3617511520737331},
  {390.4175222450376, 0.4677419354838712},
  {400.2737850787132, 0.566820276497696},
  {412.8678986995209, 0.6428571428571432},
  {423.27173169062286, 0.6889400921658988},
  {434.7707049965777, 0.7396313364055301},
  {453.11430527036276, 0.7534562211981568},
  {472.00547570157426, 0.7557603686635946},
  {484.5995893223819, 0.7258064516129034},
  {496.6461327857632, 0.6774193548387097},
  {507.0499657768652, 0.631336405529954},
  {524.0246406570842, 0.6221198156682031},
  {538.8090349075976, 0.6290322580645162},
  {554.6885694729638, 0.6428571428571432},
  {571.1156741957564, 0.6612903225806452},
  {583.1622176591376, 0.6889400921658988},
  {597.946611909651, 0.7165898617511521},
  {613.8261464750171, 0.7004608294930879},
  {630.8008213552362, 0.6866359447004611},
  {644.4900752908967, 0.6866359447004611},
  {661.4647501711157, 0.7004608294930879},
  {678.4394250513346, 0.7327188940092166},
  {692.6762491444217, 0.7718894009216589},
  {705.2703627652293, 0.804147465437788},
  {715.6741957563313, 0.8248847926267281},
  {726.6255989048598, 0.7995391705069126},
  {731.006160164271, 0.7073732718894012},
  {733.7440109514032, 0.6059907834101386},
  {737.303216974675, 0.5092165898617513},
  {740.3148528405201, 0.4124423963133643},
  {743.3264887063656, 0.3064516129032262},
  {747.707049965777, 0.1958525345622124},
  {752.3613963039015, 0.10829493087557651},
  {758.9322381930185, 0.016129032258064946},
  {769.3360711841206, -0.057603686635943285},
  {775.9069130732375, -0.07142857142857095}
};
/* Rollei Retro 80s absolute log sensitivity */
const static spectra_entry rollei_retro_80s[] = {
  {335.44303797468365, -0.004158004158005824},
  {340.50632911392404, 0.21413721413721376},
  {346.20253164556965, 0.4636174636174637},
  {351.2658227848103, 0.6923076923076916},
  {358.2278481012659, 0.8690228690228685},
  {372.1518987341773, 0.9885654885654889},
  {382.2784810126582, 1.087318087318085},
  {384.8101265822785, 1.1548856548856552},
  {402.5316455696203, 1.264033264033264},
  {411.3924050632911, 1.316008316008316},
  {445.56962025316454, 1.321205821205821},
  {462.02531645569627, 1.316008316008316},
  {481.0126582278482, 1.2484407484407467},
  {491.77215189873436, 1.222453222453221},
  {500.0000000000001, 1.2328482328482324},
  {509.49367088607585, 1.3316008316008277},
  {524.0506329113924, 1.4147609147609144},
  {544.3037974683544, 1.4355509355509342},
  {558.2278481012659, 1.4407484407484406},
  {577.2151898734178, 1.5654885654885655},
  {589.240506329114, 1.6174636174636166},
  {600.632911392405, 1.622661122661122},
  {611.3924050632912, 1.503118503118503},
  {618.3544303797469, 1.4199584199584199},
  {625.3164556962026, 1.3575883575883574},
  {635.4430379746836, 1.367983367983368},
  {641.7721518987343, 1.3575883575883574},
  {656.9620253164558, 1.4511434511434516},
  {671.5189873417723, 1.5343035343035343},
  {677.8481012658232, 1.539501039501038},
  {684.8101265822786, 1.5810810810810807},
  {694.9367088607596, 1.5862785862785862},
  {706.3291139240507, 1.669438669438669},
  {727.848101265823, 1.6902286902286905},
  {736.7088607594939, 1.6382536382536377},
  {742.4050632911392, 1.492723492723493},
  {750.632911392405, 1.180873180873181},
  {757.5949367088609, 0.9002079002078998},
  {760.7594936708861, 0.7650727650727651},
  {765.1898734177215, 0.5987525987525988},
  {770.8860759493672, 0.3804573804573801},
  {774.6835443037975, 0.21413721413721376},
  {775.9493670886078, -0.004158004158004935}
};
/* Approximation of spicer-dufay. Rollei emulsion with faster cut after 750.  */
const static spectra_entry spicer_dufay_guess[] = {
  {335.44303797468365, 0},
  {340.50632911392404, 0.21413721413721376},
  {346.20253164556965, 0.4636174636174637},
  {351.2658227848103, 0.6923076923076916},
  {358.2278481012659, 0.8690228690228685},
  {372.1518987341773, 0.9885654885654889},
  {382.2784810126582, 1.087318087318085},
  {384.8101265822785, 1.1548856548856552},
  {402.5316455696203, 1.264033264033264},
  {411.3924050632911, 1.316008316008316},
  {445.56962025316454, 1.321205821205821},
  {462.02531645569627, 1.316008316008316},
  {481.0126582278482, 1.2484407484407467},
  {491.77215189873436, 1.222453222453221},
  {500.0000000000001, 1.2328482328482324},
  {509.49367088607585, 1.3316008316008277},
  {524.0506329113924, 1.4147609147609144},
  {544.3037974683544, 1.4355509355509342},
  {558.2278481012659, 1.4407484407484406},
  {577.2151898734178, 1.5654885654885655},
  {589.240506329114, 1.6174636174636166},
  {600.632911392405, 1.622661122661122},
  {611.3924050632912, 1.503118503118503},
  {618.3544303797469, 1.4199584199584199},
  {625.3164556962026, 1.4175883575883574},
  {640, 1.40},
  {650, 1.4},
  {660, 1.35},
  {660, 1.1},
  {680, 0},
#if 0
  {635.4430379746836, 1.367983367983368},
  {641.7721518987343, 1.3575883575883574},
  {656.9620253164558, 1.4511434511434516},
  {671.5189873417723, 1.33},
  {677.8481012658232, 1.33},
  {684.8101265822786, 1.33},
  {694.9367088607596, 1.33},
  {706.3291139240507, 1.33},
  {727.848101265823, 1.33},
  {736.7088607594939, 1.23},
  {742.4050632911392, 1.1},
  {750.632911392405, 0.7},
  {753.7594936708861, 0},
#endif
};
}

void
set_response (spectrum film_response, spectrum_dyes_to_xyz::responses type)
{
  switch (type)
  {
  case spectrum_dyes_to_xyz::neopan_100:
    {
      spectrum dl;
      set_illuminant_to (dl, spectrum_dyes_to_xyz::il_D, 5400);
      compute_log_sensitivity (film_response, sizeof (wedge_Neopan_100_acros_daylight_5400k) / sizeof (spectra_entry), wedge_Neopan_100_acros_daylight_5400k);
      log_sensitivity_to_reversal_transmitance (film_response);
      for (int i = 0; i < SPECTRUM_SIZE; i++)
	if (dl[i])
	  film_response[i] /= dl[i];
    }
    break;
  case spectrum_dyes_to_xyz::ilford_panchromatic:
    {
      spectrum dl;
      set_illuminant_to (dl, spectrum_dyes_to_xyz::il_D, 5400);
      compute_spectrum (film_response, sizeof (ilford_manual_of_photography_panchromatic_emulsion_fig54) / sizeof (spectra_entry), ilford_manual_of_photography_panchromatic_emulsion_fig54, false);
      //log2_sensitivity_to_reversal_transmitance (film_response);
      for (int i = 0; i < SPECTRUM_SIZE; i++)
      {
	if (film_response[i] < 0)
	  film_response [i] = 0;
	else if (dl[i])
	  film_response[i] /= dl[i];
      }
    }
    break;
  case spectrum_dyes_to_xyz::ilford_panchromatic_fp4:
    {
      /* It is best to clamp missing data to 0 for spectral response.
	 We make sure it remans zero in log_sensitivity_to_reversal_transmiatance  */
      compute_log_sensitivity (film_response, sizeof (ilford_fp4_absolute) / sizeof (spectra_entry), ilford_fp4_absolute);
      log_sensitivity_to_reversal_transmitance (film_response);
    }
    break;
  case spectrum_dyes_to_xyz::ilford_sfx200:
    {
      spectrum dl;
      set_illuminant_to (dl, spectrum_dyes_to_xyz::il_A);
      compute_log_sensitivity (film_response, sizeof (ilford_sfx200_wedge_tungsten) / sizeof (spectra_entry), ilford_sfx200_wedge_tungsten);
      log_sensitivity_to_reversal_transmitance (film_response);
      for (int i = 0; i < SPECTRUM_SIZE; i++)
	if (dl[i])
	  film_response[i] /= dl[i];
    }
    break;
  case spectrum_dyes_to_xyz::rollei_retro_80s:
    {
      compute_log_sensitivity (film_response, sizeof (rollei_retro_80s) / sizeof (spectra_entry), rollei_retro_80s);
      log_sensitivity_to_reversal_transmitance (film_response);
    }
    break;
  case spectrum_dyes_to_xyz::spicer_dufay_guess:
    {
      compute_log_sensitivity (film_response, sizeof (spicer_dufay_guess) / sizeof (spectra_entry), spicer_dufay_guess);
      log_sensitivity_to_reversal_transmitance (film_response);
    }
    break;
  case spectrum_dyes_to_xyz::observer_y:
    for (int i = 0; i < SPECTRUM_SIZE; i++)
      film_response[i] = cie_cmf_y [i];
    break;
  case spectrum_dyes_to_xyz::response_even:
    for (int i = 0; i < SPECTRUM_SIZE; i++)
      film_response[i] = 1;
    break;
  }
}
